rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Helper function to check if a user is authenticated
    function isSignedIn() {
      return request.auth != null;
    }

    // Allow public read access to all files.
    // This simplifies displaying images (products, user profiles, etc.) across the app
    // without needing complex rules based on database lookups.
    // The security comes from the fact that file names/URLs are not guessable.
    match /{allPaths=**} {
      allow read: if true;
    }

    // Restrict write access to authenticated users only.
    // This prevents anonymous users from uploading files.
    match /{allPaths=**} {
      allow write: if isSignedIn();
    }
    
    // Optional: More granular write control if needed in the future.
    // For example, only allow users to write to a path corresponding to their UID.
    // match /users/{userId}/{allPaths=**} {
    //   allow write: if isSignedIn() && request.auth.uid == userId;
    // }
    //
    // match /products/{userId}/{allPaths=**} {
    //   allow write: if isSignedIn() && request.auth.uid == userId;
    // }
  }
}
