# üí∞ **COMMISSION STRUCTURE - THE COMPLETE TRUTH**

## üéØ **Overview: Two-Tier Commission System**

The Wellness Tree uses a **sophisticated dual-commission system** that ensures fair distribution between Platform, Dispensaries, and Influencers.

---

## üìä **THE FOUNDATION: Platform's 25% Profit**

### **Base Transaction Flow**

```
Customer Buys Product for R125
‚îú‚îÄ Dispensary's Base Price: R100 (what they set)
‚îî‚îÄ Platform Commission: R25 (25% of R100 = Platform's profit)
```

**KEY PRINCIPLE**: All influencer commissions are calculated as **percentages of the platform's R25 profit**, NOT the R125 customer price!

---

## üåü **INFLUENCER BASE COMMISSION** (Tier-Based)

### **How It Works**

Influencers earn a percentage of the **platform's 25% profit** based on their tier level:

| Tier | Monthly Sales | Rate | Of Platform Profit | Of Customer Price |
|------|---------------|------|-------------------|-------------------|
| üå∞ **Seed** | R0-R5K | **5%** | 5% of R25 = **R1.25** | 1.25% of R100 |
| üå± **Sprout** | R5K-R20K | **10%** | 10% of R25 = **R2.50** | 2.5% of R100 |
| üåø **Growth** | R20K-R50K | **12%** | 12% of R25 = **R3.00** | 3% of R100 |
| üå∏ **Bloom** | R50K-R100K | **15%** | 15% of R25 = **R3.75** | 3.75% of R100 |
| üå≤ **Forest** | R100K+ | **20%** | 20% of R25 = **R5.00** | 5% of R100 |

### **Example Calculation (Sprout Tier)**

```
Customer Order: R125
‚îú‚îÄ Dispensary Base: R100
‚îú‚îÄ Platform Profit: R25 (25% of R100)
‚îî‚îÄ Influencer Earns: R2.50 (10% of R25)

Breakdown:
- Customer pays: R125.00
- Dispensary gets: R100.00
- Platform keeps: R22.50 (R25 - R2.50)
- Influencer earns: R2.50 ‚úÖ
```

---

## üé® **ADVERTISING AD BONUS** (Dispensary-Set)

### **What It Is**

When a dispensary creates an advertisement and enables it for the influencer marketplace, they can offer an **additional ad bonus** (0-5% of platform's 25% profit) to incentivize influencers to promote that specific ad.

### **Key Rules**

1. **Ad Bonus Range**: 0-5% (hard limit!)
2. **Calculated From**: Platform's 25% profit (same as base commission)
3. **Paid By**: **Dispensary** (deducted from their payout)
4. **In Addition To**: Base tier commission (influencer gets BOTH!)

### **Example Calculation (Sprout + 3% Ad Bonus)**

```
Customer Order through Influencer's Ad Link: R125
‚îú‚îÄ Dispensary Base: R100
‚îú‚îÄ Platform Profit: R25 (25% of R100)
‚îÇ
‚îú‚îÄ Influencer Base Commission (Sprout 10%): R2.50 (10% of R25)
‚îî‚îÄ Influencer Ad Bonus (Dispensary set 3%): R0.75 (3% of R25)
    ‚Ü≥ Total Influencer Earns: R3.25 ‚úÖ

Final Distribution:
- Customer pays: R125.00
- Dispensary gets: R99.25 (R100 - R0.75 ad bonus) ‚ö†Ô∏è
- Platform keeps: R22.50 (R25 - R2.50 base commission)
- Influencer earns: R3.25 (R2.50 base + R0.75 ad bonus) ‚úÖ
```

**üí° CRITICAL**: The R0.75 ad bonus is **DEDUCTED from the dispensary's R100 payout**, NOT from the platform's profit!

---

## üîÑ **COMPLETE FLOW DIAGRAM**

### **Scenario 1: Regular Referral (No Ad)**

```
Customer clicks influencer's referral link ‚Üí Buys R125 product

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CUSTOMER PAYS: R125.00                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ REVENUE SPLIT:                                      ‚îÇ
‚îÇ ‚îú‚îÄ Dispensary: R100.00 (base price)                ‚îÇ
‚îÇ ‚îî‚îÄ Platform Profit: R25.00 (25% commission)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ INFLUENCER COMMISSION (from Platform Profit):       ‚îÇ
‚îÇ ‚îú‚îÄ Sprout (10%): R2.50 (10% of R25)               ‚îÇ
‚îÇ ‚îî‚îÄ Platform Keeps: R22.50                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

FINAL EARNINGS:
‚úÖ Dispensary: R100.00
‚úÖ Platform: R22.50
‚úÖ Influencer: R2.50
```

### **Scenario 2: Influencer Promotes Dispensary's Ad (With 3% Ad Bonus)**

```
Customer clicks influencer's ad tracking link ‚Üí Buys R125 product

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CUSTOMER PAYS: R125.00                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ REVENUE SPLIT:                                      ‚îÇ
‚îÇ ‚îú‚îÄ Dispensary: R100.00 (base price)                ‚îÇ
‚îÇ ‚îî‚îÄ Platform Profit: R25.00 (25% commission)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ INFLUENCER COMMISSION:                              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ BASE (from Platform Profit):                       ‚îÇ
‚îÇ ‚îú‚îÄ Sprout (10%): R2.50 (10% of R25)              ‚îÇ
‚îÇ ‚îî‚îÄ Platform Keeps: R22.50                         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ AD BONUS (from Dispensary Payout):                 ‚îÇ
‚îÇ ‚îú‚îÄ Ad Bonus (3%): R0.75 (3% of R25) ‚ö†Ô∏è           ‚îÇ
‚îÇ ‚îî‚îÄ Deducted from Dispensary!                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

FINAL EARNINGS:
‚úÖ Dispensary: R99.25 (R100 - R0.75 ad bonus) ‚ö†Ô∏è
‚úÖ Platform: R22.50 (unchanged)
‚úÖ Influencer: R3.25 (R2.50 base + R0.75 ad bonus) üéâ
```

---

## üìà **AD BONUS RATE RECOMMENDATIONS**

### **For Dispensaries**

| Product Margin | Recommended Ad Bonus | Expected Influencer Response |
|----------------|---------------------|------------------------------|
| **High Margin** (50%+) | **4-5%** | Influencers go ALL IN! üî• |
| **Standard** (30-50%) | **2-3%** | Good interest, solid promotion |
| **Low Margin** (20-30%) | **1-2%** | Moderate interest |
| **Clearance Items** | **0-1%** | You're just trying to move stock |

### **Example Impact (R100 base product)**

| Ad Bonus | Dispensary Loses | Influencer Gains | Total Influencer (Sprout) |
|----------|------------------|------------------|---------------------------|
| 0% | R0.00 | R0.00 | R2.50 (base only) |
| 1% | R0.25 | R0.25 | R2.75 |
| 2% | R0.50 | R0.50 | R3.00 |
| 3% | R0.75 | R0.75 | R3.25 ‚≠ê |
| 4% | R1.00 | R1.00 | R3.50 |
| 5% | R1.25 | R1.25 | R3.75 (MAX!) üî• |

**üí° PRO TIP**: **3% ad bonus** is the sweet spot! Influencers earn 30% more (R2.50 ‚Üí R3.25) while you only lose R0.75 per sale.

---

## üßÆ **CALCULATIONS IN CODE**

### **Calculate Influencer Base Commission**

```typescript
// Platform profit is always 25% of dispensary's base price
const dispensaryBasePrice = 100;
const platformProfit = dispensaryBasePrice * 0.25; // R25

// Influencer tier rate (% of platform profit)
const influencerTierRate = 10; // Sprout = 10%
const baseCommission = platformProfit * (influencerTierRate / 100); // R2.50
```

### **Calculate Influencer Ad Bonus**

```typescript
// Ad bonus rate set by dispensary (0-5% of platform profit)
const adBonusRate = 3; // Dispensary offers 3%
const adBonusAmount = platformProfit * (adBonusRate / 100); // R0.75

// Total influencer earns
const totalInfluencerCommission = baseCommission + adBonusAmount; // R3.25

// Dispensary payout reduction
const dispensaryPayoutAfterAdBonus = dispensaryBasePrice - adBonusAmount; // R99.25
```

### **Validation Logic**

```typescript
// Ensure ad bonus never exceeds 5%
const MAX_AD_BONUS_RATE = 5;
if (adBonusRate > MAX_AD_BONUS_RATE) {
  throw new Error(`Ad bonus rate cannot exceed ${MAX_AD_BONUS_RATE}%`);
}

// Ensure dispensary can afford the ad bonus
if (adBonusAmount > dispensaryBasePrice * 0.05) {
  throw new Error('Ad bonus would exceed 5% of dispensary base price');
}
```

---

## üìä **ANALYTICS & REPORTING**

### **What Gets Tracked**

#### **For Influencers:**
- `baseCommission` - Tier-based commission from platform profit
- `adBonus` - Additional bonus from dispensary (if via ad)
- `totalCommission` - Sum of base + ad bonus
- `platformProfit` - The R25 (25%) that all commissions are calculated from
- `tierRate` - Current tier percentage
- `adBonusRate` - Ad bonus percentage (if applicable)

#### **For Dispensaries:**
- `baseRevenue` - Dispensary's set price (R100)
- `adBonusPaid` - Total ad bonus deducted from payouts
- `netRevenue` - baseRevenue - adBonusPaid
- `influencerConversions` - Sales driven by influencer ads
- `adBonusROI` - Revenue from influencer ads vs ad bonus cost

#### **For Super Admin (Platform):**
- `totalPlatformProfit` - All 25% commissions collected
- `influencerBasePaid` - Total base tier commissions paid
- `influencerAdBonusPaid` - Total ad bonuses paid (by dispensaries)
- `netPlatformRevenue` - platformProfit - influencerBasePaid
- `dispensaryAdBonusDeductions` - Total deducted from dispensary payouts

---

## üéØ **SYSTEM IMPACT**

### **Database Collections Updated**

1. **`influencerCommissions`** - Tracks base tier commissions
   ```typescript
   {
     platformProfit: 25.00,
     tierRate: 10,
     baseCommission: 2.50,
     adBonusRate: 0,
     adBonusAmount: 0,
     totalCommission: 2.50
   }
   ```

2. **`adConversions`** - Tracks ad-driven sales with bonus
   ```typescript
   {
     platformProfit: 25.00,
     baseCommissionRate: 10,
     baseCommissionAmount: 2.50,
     adBonusRate: 3,
     adBonusAmount: 0.75,
     totalInfluencerCommission: 3.25,
     dispensaryPayoutBefore: 100.00,
     dispensaryPayoutAfter: 99.25,
     dispensaryAdBonusDeduction: 0.75
   }
   ```

3. **`influencerAdSelections`** - Tracks selected ads
   ```typescript
   {
     influencerTierRate: 10,
     adBonusRate: 3,
     commissionRate: 13, // Display: 10 + 3
     performance: {
       baseCommission: 125.00,
       adBonus: 37.50,
       totalCommission: 162.50
     }
   }
   ```

4. **`dispensaryEarnings`** - Tracks dispensary payouts
   ```typescript
   {
     baseRevenue: 5000.00,
     adBonusDeductions: 37.50,
     netRevenue: 4962.50,
     adBonusROI: 12.5 // (R468 revenue / R37.50 bonus) = 12.5x
   }
   ```

---

## ‚úÖ **UPDATED COMPONENTS**

### **Cloud Functions**
- ‚úÖ `functions/src/advertising.ts` - trackAdConversion()
- ‚úÖ `functions/src/influencer-commissions.ts` - processInfluencerCommission()

### **Types**
- ‚úÖ `src/types/advertising.ts` - InfluencerAdSelection interface
- ‚úÖ `src/types/advertising.ts` - Advertisement.influencerCommission interface

### **Documentation**
- ‚úÖ `docs/COMMISSION-STRUCTURE-EXPLAINED.md` (this file)
- üîÑ `docs/DISPENSARY-ADVERTISING-QUICKSTART.md` (needs commission rate updates)
- üîÑ `docs/INFLUENCER-MARKETPLACE-TUTORIAL.md` (needs commission structure updates)

### **UI Components** (To Update)
- ‚è≥ Home page promo dialogs (influencer onboarding section)
- ‚è≥ Influencer dashboard (earnings display)
- ‚è≥ Dispensary ad creation (ad bonus rate input with 5% max)
- ‚è≥ Financial Hub (analytics breakdown)
- ‚è≥ Super Admin analytics (platform profit tracking)

---

## üö® **COMMON MISTAKES TO AVOID**

### ‚ùå **WRONG**: Calculating influencer commission from customer price
```typescript
// DON'T DO THIS!
const customerPrice = 125;
const influencerCommission = customerPrice * 0.10; // R12.50 ‚ùå TOO HIGH!
```

### ‚úÖ **CORRECT**: Calculate from platform's 25% profit
```typescript
// DO THIS!
const dispensaryPrice = 100;
const platformProfit = dispensaryPrice * 0.25; // R25
const influencerCommission = platformProfit * 0.10; // R2.50 ‚úÖ
```

### ‚ùå **WRONG**: Deducting ad bonus from platform profit
```typescript
// DON'T DO THIS!
const platformProfit = 25;
const adBonus = 0.75;
const platformKeeps = platformProfit - adBonus; // R24.25 ‚ùå WRONG PAYER!
```

### ‚úÖ **CORRECT**: Deduct ad bonus from dispensary payout
```typescript
// DO THIS!
const dispensaryBase = 100;
const adBonus = 0.75;
const dispensaryPayout = dispensaryBase - adBonus; // R99.25 ‚úÖ
```

---

## üìû **Questions?**

**For Developers**: Check `src/lib/influencer-utils.ts` ‚Üí `calculateInfluencerCommission()`  
**For Dispensaries**: See `docs/DISPENSARY-ADVERTISING-QUICKSTART.md` ‚Üí Influencer Settings  
**For Influencers**: See `docs/INFLUENCER-MARKETPLACE-TUTORIAL.md` ‚Üí Commission Structure  

---

*Last Updated: January 22, 2026*  
*Version: 2.0 - Dual-Commission System*  

üåø **"Fair profits for all, growth for everyone."** üåø
